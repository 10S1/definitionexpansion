from cnltransforms.document import get_shell
from cnltransforms.gfxml import G, X, linearize_mtree_contents, final_recovery, XT
from cnltransforms.treevis import *


tree = G(
        'kind_with_arg',
        [
            G('prekind_to_kind', [
                X('span', [G('property_prekind', [G('finite', []), G('subset', [])])]),
            ]),
            G('Œîof ‚Ñï')
            ]
        )

tree = G(
        'kind_with_arg',
        [
            X('span', [G('prekind_to_kind', [
                G('property_prekind', [G('finite', []), G('subset', [])]),
            ])]),
            G('Œîof ‚Ñï')
            ]
        )

print(dot_to_svg(tree_to_dot(tree)))

# tree = X('math', [X('mo', [XT('{')], {'data-ftml-comp': ''}, None), X('abc', [])], {'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=set&s=set comprehension', 'data-ftml-notationid': '', 'data-ftml-term': 'OMBIND', 'data-ftml-definiens': ''}, None)
# print(tree.to_gf())
# tree = G('def_sentence', [G('plain_defcore', [G('define_nkind_as_nkind', [X('span', [G('name_kind', [G('prekind_to_kind', [G('lex_walk', [])]), G('no_ident', [])])], {'data-ftml-definiendum': 'https://stexmmt.mathhub.info/:sTeX?a=Papers/cicm25-ling&p=mod&m=quiver-walk/EXTSTRUCT_1&s=walk'}, 'wrapped_named_kind'), X('span', [G('such_that_named_kind_v2', [G('name_kind', [G('kind_with_arg', [G('prekind_to_kind', [G('property_prekind', [X('span', [X('span', [G('lex_finite', [])], {'data-ftml-comp': ''}, 'wrapped_property')], {'data-ftml-term': 'OMID', 'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=finite-cardinality&s=finite', 'data-ftml-notationid': ''}, 'wrapped_property'), X('span', [X('span', [G('lex_sequence', [])], {'data-ftml-comp': ''}, 'wrapped_prekind')], {'data-ftml-notationid': '', 'data-ftml-term': 'OMID', 'data-ftml-head': 'https://mathhub.info?a=smglom/mv&p=mod&m=sequence&s=sequence'}, 'wrapped_prekind')])]), G('lex_argmark_of', []), G('plural_term', [G('name_kind', [G('kind_with_arg', [G('prekind_to_kind', [X('span', [G('lex_element', [])], {'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=set&s=element', 'data-ftml-term': 'OMID'}, 'wrapped_prekind')]), G('lex_argmark_of', []), G('math_term', [X('math', [X('mrow', [X('mo', [XT('{')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mi', [XT('ùë°')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-head': 'tvar', 'data-ftml-term': 'OMV'}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '2'}, None), X('mspace', [], {'width': '0.16666667em'}, None), X('mi', [XT('|')], {'data-ftml-comp': ''}, None), X('mspace', [], {'width': '0.16666667em'}, None), X('mrow', [X('mtext', [XT('ùë°  is a   transition  ')], {}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '3'}, None), X('mo', [XT('}')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùë°')], {'data-ftml-comp': ''}, None)], {'data-ftml-head': 'tvar', 'data-ftml-term': 'OMV', 'data-ftml-notationid': ''}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'b'}, None)], {'data-ftml-invisible': 'true'}, None)], {'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=set&s=set comprehension', 'data-ftml-notationid': '', 'data-ftml-term': 'OMBIND', 'data-ftml-definiens': ''}, None)], {}, None)])]), G('no_ident', [])])])]), G('math_ident', [X('math', [X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùë§')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-term': 'OMV', 'data-ftml-head': 'wvar'}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None), X('mrow', [X('mo', [XT(':=')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('msub', [X('mi', [XT('ùëí')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mi', [XT('1')], {}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None)], {}, None)], {}, None)], {'data-ftml-head': 'eseq', 'data-ftml-notationid': '', 'data-ftml-term': 'OMA'}, None), X('mo', [XT(',')], {}, None), X('mrow', [X('mo', [XT('...')], {'data-ftml-comp': ''}, None)], {'data-ftml-head': 'http://mathhub.info?a=sTeX/meta-inf&m=Metatheory&s=ellipses', 'data-ftml-notationid': 'ldots', 'data-ftml-term': 'OMID'}, None), X('mo', [XT(',')], {}, None), X('mrow', [X('msub', [X('mi', [XT('ùëí')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùëõ')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-head': 'nvar', 'data-ftml-term': 'OMV'}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '1'}, None)], {}, None)], {}, None)], {'data-ftml-term': 'OMA', 'data-ftml-notationid': '', 'data-ftml-head': 'eseq'}, None)], {'data-ftml-term': 'OMV', 'data-ftml-notationid': '', 'data-ftml-head': 'eseq'}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '2'}, None)], {'data-ftml-notationid': '', 'data-ftml-term': 'OMA', 'data-ftml-head': 'https://mathhub.info?a=smglom/mv&p=mod&m=defeq&s=definitional equation'}, None)], {}, 'wrap_math')])]), G('stmt_for_term', [G('formula_stmt', [X('math', [X('mrow', [X('mrow', [X('mrow', [X('mrow', [X('mrow', [X('msub', [X('mi', [XT('ùúã')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mi', [XT('3')], {}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None)], {}, None)], {}, None)], {'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=cartesian-product&s=projectionFN', 'data-ftml-notationid': '', 'data-ftml-definiens': '', 'data-ftml-term': 'OMA'}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None), X('mo', [XT('(')], {}, None), X('mrow', [X('mrow', [X('mrow', [X('msub', [X('mi', [XT('ùëí')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùëñ')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-term': 'OMV', 'data-ftml-head': 'ivar'}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None)], {}, None)], {}, None)], {'data-ftml-term': 'OMA', 'data-ftml-notationid': '', 'data-ftml-head': 'eseq'}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None)], {'data-ftml-arg': '21', 'data-ftml-argmode': 'a'}, None), X('mo', [XT(')')], {}, None)], {'data-ftml-head': 'http://mathhub.info?a=sTeX/meta-inf&m=Metatheory&s=apply', 'data-ftml-term': 'OMA'}, None)], {'data-ftml-arg': '11', 'data-ftml-argmode': 'a'}, None), X('mrow', [X('mo', [XT('=')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mrow', [X('msub', [X('mi', [XT('ùúã')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mi', [XT('1')], {}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '1'}, None)], {}, None)], {}, None)], {'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=cartesian-product&s=projectionFN', 'data-ftml-term': 'OMA', 'data-ftml-notationid': '', 'data-ftml-definiens': ''}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None), X('mo', [XT('(')], {}, None), X('mrow', [X('mrow', [X('mrow', [X('msub', [X('mi', [XT('ùëí')], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mo', [XT('(')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùëñ')], {'data-ftml-comp': ''}, None)], {'data-ftml-head': 'ivar', 'data-ftml-term': 'OMV', 'data-ftml-notationid': ''}, None)], {'data-ftml-argmode': 'a', 'data-ftml-arg': '11'}, None), X('mrow', [X('mo', [XT('+')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mi', [XT('1')], {}, None)], {'data-ftml-arg': '12', 'data-ftml-argmode': 'a'}, None)], {'data-ftml-notationid': '', 'data-ftml-head': 'https://mathhub.info?a=smglom/arithmetics&p=mod&m=natarith&s=addition', 'data-ftml-term': 'OMA'}, None), X('mrow', [X('mo', [XT(')')], {}, None)], {'data-ftml-comp': ''}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None)], {}, None)], {}, None)], {'data-ftml-head': 'eseq', 'data-ftml-term': 'OMA', 'data-ftml-notationid': ''}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '1'}, None)], {'data-ftml-arg': '21', 'data-ftml-argmode': 'a'}, None), X('mo', [XT(')')], {}, None)], {'data-ftml-head': 'http://mathhub.info?a=sTeX/meta-inf&m=Metatheory&s=apply', 'data-ftml-term': 'OMA'}, None)], {'data-ftml-arg': '12', 'data-ftml-argmode': 'a'}, None)], {'data-ftml-term': 'OMA', 'data-ftml-head': 'https://mathhub.info?a=smglom/mv&p=mod&m=equal&s=equal', 'data-ftml-notationid': ''}, None)], {}, 'wrap_math')]), G('quantified_nkind', [G('universal_quantification_pl', []), G('formula_named_kind', [X('math', [X('mrow', [X('mrow', [X('mi', [XT('1')], {}, None)], {'data-ftml-arg': '1', 'data-ftml-argmode': 'i'}, None), X('mrow', [X('mrow', [X('mrow', [X('mo', [XT('<')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-head': 'https://mathhub.info?a=smglom/arithmetics&p=mod&m=natarith&s=less than', 'data-ftml-term': 'OMID'}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '2'}, None)], {}, None), X('mrow', [X('mrow', [X('mi', [XT('ùëñ')], {'data-ftml-comp': ''}, None)], {'data-ftml-term': 'OMV', 'data-ftml-head': 'ivar', 'data-ftml-notationid': ''}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '3'}, None), X('mrow', [X('mrow', [X('mrow', [X('mo', [XT('‚â§')], {'data-ftml-comp': ''}, None)], {'data-ftml-term': 'OMID', 'data-ftml-notationid': '', 'data-ftml-head': 'https://mathhub.info?a=smglom/arithmetics&p=mod&m=natarith&s=less than or equal'}, None)], {'data-ftml-arg': '4', 'data-ftml-argmode': 'i'}, None)], {}, None), X('mrow', [X('mrow', [X('mo', [XT('(')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mrow', [X('mrow', [X('mi', [XT('ùëõ')], {'data-ftml-comp': ''}, None)], {'data-ftml-notationid': '', 'data-ftml-term': 'OMV', 'data-ftml-head': 'nvar'}, None)], {'data-ftml-argmode': 'a', 'data-ftml-arg': '11'}, None), X('mrow', [X('mo', [XT('‚Äî')], {}, None)], {'data-ftml-comp': ''}, None), X('mrow', [X('mi', [XT('1')], {}, None)], {'data-ftml-argmode': 'a', 'data-ftml-arg': '12'}, None)], {'data-ftml-head': 'https://mathhub.info?a=smglom/arithmetics&p=mod&m=natarith&s=subtraction', 'data-ftml-notationid': '', 'data-ftml-term': 'OMA'}, None), X('mrow', [X('mo', [XT(')')], {}, None)], {'data-ftml-comp': ''}, None)], {'data-ftml-argmode': 'i', 'data-ftml-arg': '5'}, None)], {'data-ftml-notationid': '', 'data-ftml-term': 'OMA', 'data-ftml-head': 'https://mathhub.info?a=smglom/sets&p=mod&m=multirel&s=multirelii'}, None)], {}, 'wrap_math')])])])])], {'data-ftml-definiens': 'https://stexmmt.mathhub.info/:sTeX?a=Papers/cicm25-ling&p=mod&m=quiver-walk/EXTSTRUCT_1&s=walk'}, 'wrapped_named_kind')])])])
#
# shell = get_shell('en')
#
# linearize_mtree_contents(lambda s: shell.handle_command(f'linearize {s}'), tree)
# recovery_info, gf_input = tree.to_gf()
# gf_lin = shell.handle_command(f'linearize {gf_input}')
# print('------------')
# print(gf_lin)
# print('------------')
# print(recovery_info)
# print('------------')
# print(recovery_info[7])
# print('------------')
# print(final_recovery(gf_lin, recovery_info))

